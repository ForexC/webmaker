<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

        <title>Install</title>

        <style>
            body {
                background-color: white;
                font-family: Helvetica, Arial, sans-serif;
                text-align: center;
                margin: 40px;
            }

            h1 {
                color: #999;
                font-size: 1.4em;
                font-weight: normal;
            }

            #container {
                width: 80%;
                margin: 40px auto;
            }
        </style>
    </head>

    <body>
        <img src="https://webmaker.org/img/logo.png" width="200px" alt="" />

        <div id="container">
            <h1 id="message"></h1>
        </div>

        <script>
            var isDev = window.location.search.indexOf('dev') !== -1;
            var isFFOS = typeof window.navigator.mozApps !== 'undefined' && navigator.userAgent.indexOf('Mobile') !== -1;
            var isAndroid = navigator.userAgent.indexOf('Android') !== -1;

            // Define manifest, apk URL
            var baseUrl = 'https://webmaker-dist.s3.amazonaws.com';
            var apkUrl =  baseUrl + (isDev ? '/dev' : '/staging') + '/android/CordovaApp-debug.apk';
            var manifestUrl = baseUrl + (isDev ? '/manifest-dev.webapp' : '/manifest.webapp');

            var message;

            if (isFFOS) {
                message = 'Installing...';
                var request = window.navigator.mozApps.installPackage(manifestUrl);

                request.onsuccess = function () {
                    var appRecord = this.result;
                    alert('Installation successful!');
                };

                request.onerror = function () {
                    alert('Install failed, error: ' + this.error.name);
                };
            } else if (isAndroid) {
                message = 'Downloading apk...';
                window.location = apkUrl;
            } else {
                message = 'You should visit mzl.la/webmaker on an Android or FirefoxOS device';
            }

            document.getElementById('message').innerHTML = message;

        </script>
    </body>
</html>
